/*! For license information please see main.84fe4dd0f2fc486c6610.bundle.js.LICENSE.txt */
(()=>{var e,t={751:(e,t,s)=>{"use strict";s(260);class i extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(0),this.createLoadingGraphics(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(8971347,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("MenuScene")}createLoadingGraphics(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(16777215,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}const a=class{constructor(e){this.source=e,this.scene=e.scene,this.init(),this.createFireEmiiter(),this.createSmokeEmitter()}playFireEmit(){this.fireEmitter.explode(30,this.source.x,this.source.y)}playSmokeEmit(){this.smokeEmitter.explode(20,this.source.x,this.source.y)}init(){this.fireEmitterManager=this.scene.add.particles("explode"),this.smokeEmitterManager=this.scene.add.particles("cloud")}createFireEmiiter(){this.fireEmitter=this.fireEmitterManager.createEmitter({x:this.source.x,y:this.source.y,speed:{min:-800,max:800},angle:{min:0,max:360},scale:{start:1,end:0},blendMode:"SCREEN",lifespan:500,on:!1})}createSmokeEmitter(){this.smokeEmitter=this.smokeEmitterManager.createEmitter({x:this.source.x,y:this.source.y,speed:{min:-800,max:100},angle:{min:0,max:360},alpha:{start:1,end:0},blendMode:"SCREEN",lifespan:500,on:!1})}};class h extends Phaser.GameObjects.Image{die(){}getBaseHealth(){return this.baseHealth}getRemainingHealth(){return this.remainingHealth}gotHitByBullet(e){}}const n=h,o=class extends n{handleShooting(){}gotHitByBullet(e){}die(){}getBarrel(){return this.barrel}getBullets(){return this.bullets}getColor(){return this.color}};class r extends Phaser.GameObjects.Image{rotateToTarget(e){}handleShoot(){}playShootingSound(){}pause(){}resume(){}}const l=r,c=class{constructor(e){this.source=e,this.scene=e.scene,this.init(),this.createExplodeEmitter(),this.createFlyingEmitter()}playFlyingEmit(){this.flyingEmitter.start()}playExplodeEmit(){this.explodeEmitter.explode(32,this.source.x,this.source.y)}stopFlyingEmit(){this.flyingEmitter.stop()}init(){this.emitterManager=this.scene.add.particles("star")}createFlyingEmitter(){this.flyingEmitter=this.emitterManager.createEmitter({lifespan:200,speed:100,scale:{start:.8,end:0},blendMode:"ADD",follow:this.source,on:!1})}createExplodeEmitter(){this.explodeEmitter=this.emitterManager.createEmitter({x:this.source.x,y:this.source.y,lifespan:500,speed:200,angle:{start:0,end:360,steps:32},scale:{start:.8,end:0},blendMode:"ADD",on:!1})}};class d extends Phaser.GameObjects.Image{explode(){}fly(e,t){}stop(){}pause(){}resume(){}getDamage(){return this.damage}}const p=d,u=class extends p{constructor(e){super(e.scene,e.x,e.y,`bullet${e.getColor()}`),this.tank=e,this.init()}init(){this.speed=1e3,this.damage=50,this.color=this.tank.getColor(),this.animation=new c(this),this.states={idle:"idle",pause:"pause",flying:"flying"},this.pauseVelocity=new Phaser.Math.Vector2(0,0),this.setOrigin(.5,.5).setDepth(2),this.scene.add.existing(this),this.scene.physics.world.enable(this)}update(){}setIdle(){this.state=this.states.idle,this.setVisible(!1),this.scene.physics.world.disable(this)}fly(e,t){this.state=this.states.flying,this.setVisible(!0),this.scene.physics.world.enable(this),this.setPosition(e,t),this.rotation=this.tank.barrel.rotation,this.scene.physics.velocityFromRotation(this.rotation-Math.PI/2,this.speed,this.body.velocity),this.animation.playFlyingEmit()}stop(){this.explode()}explode(){this.animation.stopFlyingEmit(),this.body.setVelocity(0,0),this.scene.physics.world.disable(this),this.setVisible(!1),this.animation.playExplodeEmit(),this.scene.time.delayedCall(500,(()=>{this.state=this.states.idle}))}pause(){this.state=this.states.pause,this.pauseVelocity.x=this.body.velocity.x,this.pauseVelocity.y=this.body.velocity.y,this.body.setVelocity(0,0),this.animation.stopFlyingEmit()}resume(){this.state=this.states.flying,this.body.setVelocity(this.pauseVelocity.x,this.pauseVelocity.y),this.animation.playFlyingEmit()}},y=class extends l{constructor(e){super(e.scene,e.x,e.y,`barrel${e.getColor()}`),this.setOrigin(.5,1).setDepth(1).setAngle(180),this.echoShootingTime=100,this.tank=e,this.scene.add.existing(this)}update(){this.x=this.tank.x,this.y=this.tank.y}handleShoot(){this.scene.time.now>this.tank.lastShoot+this.tank.shootingRate?this.shoot():this.scene.time.now-this.tank.lastShoot>this.echoShootingTime&&this.loading()}pause(){this.pauseTime=this.scene.time.now}resume(){this.tank.lastShoot+=this.scene.time.now-this.pauseTime}shoot(){this.scene.cameras.main.shake(20,.005);for(let e of this.tank.bullets.getChildren()){if(!(e instanceof u))return;if("idle"===e.state)return this.playShootingSound(),this.tank.lastShoot=this.scene.time.now,void e.fly(this.tank.x,this.tank.y)}}playShootingSound(){this.scene.sound.mute||this.tank.fireSound.play()}loading(){this.scene.sound.mute||this.tank.fireSound.pause()}};class m extends Phaser.GameObjects.Graphics{constructor(e){super(e.scene),this.obj=e,this.scene.add.existing(this)}drawLifebar(){this.clear(),this.fillStyle(15100456,1),this.fillRect(-this.obj.width/2,this.obj.height/2,this.obj.width*(this.obj.getRemainingHealth()/this.obj.getBaseHealth()),15),this.lineStyle(2,16777215),this.strokeRect(-this.obj.width/2,this.obj.height/2,this.obj.width,15),this.setDepth(1)}update(){this.x=this.obj.x,this.y=this.obj.y}}const g=m,b=class extends o{constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.handlePause=()=>{this.bullets.getChildren().forEach((e=>{e instanceof u&&"flying"===e.state&&e.pause()})),this.barrel.pause(),this.state=this.states.pause},this.handleResume=()=>{this.bullets.getChildren().forEach((e=>{e instanceof u&&"pause"===e.state&&e.resume()})),this.barrel.resume(),this.state=this.states.alive},this.disableShooting=()=>{this.allowShoot=!1},this.enableShooting=()=>{this.allowShoot=!0},this.init(),this.addPauseEvent(),this.addResumeEvent(),this.addTouchingButtonEvent(),this.createBulletsPool(),this.scene.add.existing(this)}init(){this.color="Blue",this.baseHealth=1e3,this.remainingHealth=this.baseHealth,this.shootingRate=100,this.lastShoot=0,this.speed=200,this.rotateSpeed=.02,this.barrel=new y(this),this.lifeBar=new g(this),this.lifeBar.drawLifebar(),this.bullets=this.scene.add.group({classType:u,active:!0,maxSize:10,runChildUpdate:!0}),this.fireSound=this.scene.sound.add("gun_shooting"),this.explodeAnimation=new a(this),this.states={alive:"alive",pause:"pause",dying:"dying",die:"die"},this.state=this.states.alive,this.maxBullets=10,this.allowShoot=!0,this.setOrigin(.5,.5).setDepth(0),this.scene.physics.world.enable(this)}update(){switch(this.state){case this.states.alive:this.processAlive();break;case this.states.pause:this.processPause();break;case this.states.dying:this.processDying();break;case this.states.die:this.die()}}getPointer(){return this.controller.getPointer()}gotHitByBullet(e){this.remainingHealth-=e,this.remainingHealth<0?(this.remainingHealth=0,this.state=this.states.dying):this.lifeBar.drawLifebar()}die(){}isAllowShoot(){return this.allowShoot}move(e,t){this.scene.physics.velocityFromRotation(e,t,this.body.velocity)}rotate(e){this.rotation=e}stop(){this.body.setVelocity(0,0)}rotateBarrel(e){this.barrel.rotation=e}shoot(){this.barrel.handleShoot()}createBulletsPool(){for(let e=0;e<this.maxBullets;e++){let e=new u(this);e.setIdle(),this.bullets.add(e)}}addPauseEvent(){this.scene.scene.get("HUDScene").events.on("pauseGame",this.handlePause)}addResumeEvent(){this.scene.scene.get("HUDScene").events.on("resumeGame",this.handleResume)}addTouchingButtonEvent(){const e=this.scene.scene.get("HUDScene");e.events.on("pointerInButton",this.disableShooting),e.events.on("pointerOutButton",this.enableShooting)}processAlive(){this.barrel.update(),this.lifeBar.update()}processPause(){}processDying(){this.playDyingAnimation(),this.setDie()}playDyingAnimation(){this.explodeAnimation.playFireEmit(),this.explodeAnimation.playSmokeEmit()}setDie(){this.scene.events.emit("playerDie"),this.state=this.states.die,this.setVisible(!1),this.scene.physics.world.disable(this),this.setActive(!1),this.barrel.setVisible(!1),this.barrel.setActive(!1),this.lifeBar.setVisible(!1),this.lifeBar.setActive(!1)}},v=class extends p{constructor(e){super(e.scene,e.x,e.y,`bullet${e.getColor()}`),this.tank=e,this.init()}init(){this.speed=1e3,this.damage=10,this.color=this.tank.getColor(),this.animation=new c(this),this.states={idle:"idle",pause:"pause",flying:"flying"},this.pauseVelocity=new Phaser.Math.Vector2(0,0),this.setOrigin(.5,.5).setDepth(2),this.scene.add.existing(this),this.scene.physics.world.enable(this)}update(){}setIdle(){this.state=this.states.idle,this.setVisible(!1),this.scene.physics.world.disable(this)}fly(e,t){this.state=this.states.flying,this.setVisible(!0),this.scene.physics.world.enable(this),this.setPosition(e,t),this.rotation=this.tank.barrel.rotation,this.scene.physics.velocityFromRotation(this.rotation-Math.PI/2,this.speed,this.body.velocity),this.animation.playFlyingEmit()}stop(){this.explode()}explode(){this.animation.stopFlyingEmit(),this.body.setVelocity(0,0),this.scene.physics.world.disable(this),this.setVisible(!1),this.animation.playExplodeEmit(),this.scene.time.delayedCall(500,(()=>{this.state=this.states.idle}))}pause(){this.state=this.states.pause,this.pauseVelocity.x=this.body.velocity.x,this.pauseVelocity.y=this.body.velocity.y,this.body.setVelocity(0,0),this.animation.stopFlyingEmit()}resume(){this.state=this.states.flying,this.body.setVelocity(this.pauseVelocity.x,this.pauseVelocity.y),this.animation.playFlyingEmit()}},x=class extends l{constructor(e){super(e.scene,e.x,e.y,`barrel${e.getColor()}`),this.setOrigin(.5,1).setDepth(1).setAngle(180),this.echoShootingTime=100,this.tank=e,this.pauseTime=0,this.scene.add.existing(this)}rotateToTarget(e){let t=Phaser.Math.Angle.Between(this.tank.body.x,this.tank.body.y,e.body.x,e.body.y);this.angle=(t+Math.PI/2)*Phaser.Math.RAD_TO_DEG}handleShoot(){if(this.scene.time.now>this.tank.lastShoot+this.tank.shootingRate)for(let e of this.tank.bullets.getChildren()){if(!(e instanceof v))return;if("idle"===e.state)return this.playShootingSound(),this.tank.lastShoot=this.scene.time.now,void e.fly(this.tank.x,this.tank.y)}}update(){this.x=this.tank.x,this.y=this.tank.y}pause(){this.pauseTime=this.scene.time.now}resume(){this.tank.lastShoot+=this.scene.time.now-this.pauseTime}playShootingSound(){this.scene.sound.mute||this.tank.fireSound.play()}},f=class extends o{constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.handlePause=()=>{this.bullets.getChildren().forEach((e=>{e instanceof v&&"flying"===e.state&&e.pause()})),this.state===this.states.alive&&(this.barrel.pause(),this.moveTween.pause(),this.state=this.states.pause)},this.handleResume=()=>{this.bullets.getChildren().forEach((e=>{e instanceof v&&"pause"===e.state&&e.resume()})),this.state===this.states.pause&&(this.barrel.resume(),this.moveTween.resume(),this.state=this.states.alive)},this.init(),this.initMove(),this.addPauseEvent(),this.addResumeEvent(),this.createBulletsPool()}init(){this.color="Red",this.baseHealth=1e3,this.remainingHealth=this.baseHealth,this.shootingRate=400,this.lastShoot=0,this.speed=200,this.rotateSpeed=.02,this.barrel=new x(this),this.lifeBar=new g(this),this.lifeBar.drawLifebar(),this.bullets=this.scene.add.group({classType:v,active:!0,maxSize:10,runChildUpdate:!0}),this.fireSound=this.scene.sound.add("barrel_shoot"),this.explodeAnimation=new a(this),this.states={alive:"alive",pause:"pause",dying:"dying",die:"die"},this.state=this.states.alive,this.score=1e3,this.maxBullets=5,this.setDepth(0),this.scene.add.existing(this),this.scene.physics.world.enable(this)}update(){switch(this.state){case this.states.alive:this.processAlive();break;case this.states.pause:this.processPause();break;case this.states.dying:this.processDying();break;case this.states.die:this.die()}}handleShooting(){this.barrel.handleShoot()}gotHitByBullet(e){this.remainingHealth-=e,this.remainingHealth<0?(this.remainingHealth=0,this.state=this.states.dying):this.lifeBar.drawLifebar()}die(){}createBulletsPool(){for(let e=0;e<this.maxBullets;e++){let e=new v(this);e.setIdle(),this.bullets.add(e)}}addPauseEvent(){this.scene.scene.get("HUDScene").events.on("pauseGame",this.handlePause,this)}addResumeEvent(){this.scene.scene.get("HUDScene").events.on("resumeGame",this.handleResume)}processDying(){this.playDyingAnimation(),this.setDie()}processAlive(){this.barrel.update(),this.lifeBar.update(),this.handleShooting()}processPause(){}playDyingAnimation(){this.explodeAnimation.playFireEmit(),this.explodeAnimation.playSmokeEmit()}setDie(){this.scene.events.emit("enemyDie",this.score),this.state=this.states.die,this.setVisible(!1),this.scene.physics.world.disable(this),this.setActive(!1),this.barrel.setVisible(!1),this.barrel.setActive(!1),this.lifeBar.setVisible(!1),this.lifeBar.setActive(!1)}initMove(){this.moveTween=this.scene.tweens.add({targets:this,props:{y:this.y-200},delay:0,duration:2e3,ease:"Linear",easeParams:null,hold:0,repeat:-1,repeatDelay:0,yoyo:!0})}};class S extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture),this.initImage(),this.scene.add.existing(this)}initImage(){this.setOrigin(0,0),this.scene.physics.world.enable(this),this.body.setImmovable(!0)}update(){}}const w=class extends n{getBullets(){return this.bullets}getColor(){return this.color}handleShooting(){}gotHitByBullet(e){}die(){}};class B extends Phaser.GameObjects.Image{explode(){}fly(e,t){}stop(){}pause(){}resume(){}getDamage(){return this.damage}}const P=B,E=class extends P{constructor(e){super(e.scene,e.x,e.y,"missile"),this.plane=e,this.init()}init(){this.speed=1e3,this.damage=50,this.color=this.plane.getColor(),this.animation=new c(this),this.states={idle:"idle",pause:"pause",flying:"flying"},this.pauseVelocity=new Phaser.Math.Vector2(0,0),this.setOrigin(.5,.5).setDepth(5),this.scene.add.existing(this),this.scene.physics.world.enable(this)}update(){this.checkAutoExplode()}setIdle(){this.state=this.states.idle,this.setVisible(!1),this.scene.physics.world.disable(this)}fly(e,t){this.state=this.states.flying,this.setVisible(!0),this.scene.physics.world.enable(this),this.setPosition(e,t),this.rotation=this.plane.rotation,this.scene.physics.velocityFromRotation(this.rotation-Math.PI/2,this.speed,this.body.velocity),this.animation.playFlyingEmit()}stop(){this.explode()}explode(){this.animation.stopFlyingEmit(),this.body.setVelocity(0,0),this.scene.physics.world.disable(this),this.setVisible(!1),this.animation.playExplodeEmit(),this.scene.time.delayedCall(500,(()=>{this.state=this.states.idle}))}pause(){this.state=this.states.pause,this.pauseVelocity.x=this.body.velocity.x,this.pauseVelocity.y=this.body.velocity.y,this.body.setVelocity(0,0),this.animation.stopFlyingEmit()}resume(){this.state=this.states.flying,this.body.setVelocity(this.pauseVelocity.x,this.pauseVelocity.y),this.animation.playFlyingEmit()}checkAutoExplode(){this.state===this.states.flying&&this.distanceToTarget()>1500&&this.explode()}distanceToTarget(){return Phaser.Math.Distance.Between(this.x,this.y,this.plane.getTarget().x,this.plane.getTarget().y)}},k=class extends w{constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.handlePause=()=>{this.pauseVelocity.x=this.body.velocity.x,this.pauseVelocity.y=this.body.velocity.y,this.body.setVelocity(0,0),this.animation.stopFlyingEmit(),this.bullets.getChildren().forEach((e=>{e instanceof E&&"flying"===e.state&&e.pause()})),this.state=this.states.pause},this.handleResume=()=>{this.body.setVelocity(this.pauseVelocity.x,this.pauseVelocity.y),this.animation.playFlyingEmit(),this.bullets.getChildren().forEach((e=>{e instanceof E&&"pause"===e.state&&e.resume()})),this.state=this.states.flying},this.init(),this.addPauseEvent(),this.addResumeEvent(),this.createBulletsPool()}init(){this.color="Red",this.baseHealth=200,this.remainingHealth=this.baseHealth,this.shootingRate=1e4,this.lastShoot=0,this.speed=400,this.rotateSpeed=.01,this.lifeBar=new g(this),this.lifeBar.drawLifebar(),this.bullets=this.scene.add.group({classType:E,active:!0,maxSize:20,runChildUpdate:!0}),this.states={idle:"idle",flying:"flying",pause:"pause",dying:"dying",die:"die"},this.state=this.states.idle,this.animation=new class{constructor(e){this.source=e,this.scene=e.scene,this.init(),this.createFireEmiiter(),this.createSmokeEmitter(),this.createFlyingEmitter()}playFlyingEmit(){this.flyingEmitter.start()}playFireEmit(){this.fireEmitter.explode(30,this.source.x,this.source.y)}playSmokeEmit(){this.smokeEmitter.explode(20,this.source.x,this.source.y)}stopFlyingEmit(){this.flyingEmitter.stop()}init(){this.fireEmitterManager=this.scene.add.particles("explode"),this.smokeEmitterManager=this.scene.add.particles("cloud"),this.flyingEmitterManager=this.scene.add.particles("star")}createFlyingEmitter(){this.flyingEmitter=this.flyingEmitterManager.createEmitter({lifespan:200,speed:100,scale:{start:.8,end:0},blendMode:"ADD",follow:this.source,on:!1})}createFireEmiiter(){this.fireEmitter=this.fireEmitterManager.createEmitter({x:this.source.x,y:this.source.y,speed:{min:-800,max:800},angle:{min:0,max:360},scale:{start:1,end:0},blendMode:"SCREEN",lifespan:500,on:!1})}createSmokeEmitter(){this.smokeEmitter=this.smokeEmitterManager.createEmitter({x:this.source.x,y:this.source.y,speed:{min:-800,max:100},angle:{min:0,max:360},alpha:{start:1,end:0},blendMode:"SCREEN",lifespan:500,on:!1})}}(this),this.score=1e3,this.maxBullets=1,this.countFrames=0,this.rotateDirection=[1,-1][Phaser.Math.Between(0,1)],this.pauseVelocity=new Phaser.Math.Vector2(0,0),this.setDepth(5).setOrigin(.5,.5),this.scene.add.existing(this),this.scene.physics.world.enable(this)}update(){switch(this.state){case this.states.idle:this.processIdle();break;case this.states.flying:this.processFlying();break;case this.states.pause:this.processPause();break;case this.states.dying:this.processDying();break;case this.states.die:this.die()}}setIdle(){this.state=this.states.idle,this.setVisible(!1),this.lifeBar.setVisible(!1),this.lifeBar.setActive(!1),this.scene.physics.world.disable(this)}startFlying(){const e=this.generateRandomSpawnPosition(),t=e.x,s=e.y;this.state=this.states.flying,this.setVisible(!0),this.lifeBar.setVisible(!0),this.lifeBar.setActive(!0),this.scene.physics.world.enable(this),this.adjustPosition(t,s),this.rotateToTarget(this.target),this.scene.physics.velocityFromRotation(this.rotation,this.speed,this.body.velocity),this.rotation+=Math.PI/2,this.animation.playFlyingEmit()}handleShooting(){this.distanceToTarget()<1200&&this.launchMissile()}gotHitByBullet(e){this.remainingHealth-=e,this.remainingHealth<=0?(this.remainingHealth=0,this.state=this.states.dying,this.lifeBar.drawLifebar()):this.lifeBar.drawLifebar()}explode(){}setTarget(e){this.target=e}getTarget(){return this.target}launchMissile(){if(this.scene.time.now>this.lastShoot+this.shootingRate)for(let e of this.bullets.getChildren()){if(!(e instanceof E))return;"idle"===e.state&&(this.lastShoot=this.scene.time.now,e.fly(this.x,this.y))}}distanceToTarget(){return Phaser.Math.Distance.Between(this.x,this.y,this.target.x,this.target.y)}createBulletsPool(){for(let e=0;e<this.maxBullets;e++){let e=new E(this);e.setIdle(),this.bullets.add(e)}}adjustPosition(e,t){this.setPosition(e,t),this.body.position.x=e,this.body.position.y=t}processIdle(){}processFlying(){this.lifeBar.update(),this.handleShooting(),this.checkLaunchMissile(),this.checkFlyOutOfScreen()}checkLaunchMissile(){this.scene.time.now>this.lastShoot+300&&this.countFrames<40&&this.lastShoot>0&&(this.countFrames+=1,this.turnAway())}turnAway(){this.scene.physics.velocityFromRotation(this.rotation-Math.PI/2,this.speed,this.body.velocity),this.rotation+=this.rotateSpeed*this.rotateDirection}checkFlyOutOfScreen(){const e=this.scene.registry.get("mapSize").width+50,t=this.scene.registry.get("mapSize").height+50;(this.x<-50||this.x>e||this.y<-50||this.y>t)&&this.recycle()}recycle(){this.body.setVelocity(0,0),this.scene.physics.world.disable(this),this.setVisible(!1),this.lifeBar.setVisible(!1),this.lifeBar.setActive(!1),this.remainingHealth=this.baseHealth,this.lastShoot=0,this.countFrames=0,this.rotateDirection=[1,-1][Phaser.Math.Between(0,1)],this.pauseVelocity=new Phaser.Math.Vector2(0,0),this.lifeBar.drawLifebar(),this.state=this.states.idle}processPause(){}processDying(){this.playDyingAnimation(),this.setDie()}setDie(){this.scene.events.emit("enemyDie",this.score),this.recycle()}playDyingAnimation(){this.animation.playFireEmit(),this.animation.playSmokeEmit(),this.animation.stopFlyingEmit()}addPauseEvent(){this.scene.scene.get("HUDScene").events.on("pauseGame",this.handlePause,this)}addResumeEvent(){this.scene.scene.get("HUDScene").events.on("resumeGame",this.handleResume)}rotateToTarget(e){let t=Phaser.Math.Angle.Between(this.body.x,this.body.y,e.body.x,e.body.y);this.rotation=t}generateRandomSpawnPosition(){const e=this.scene.registry.get("mapSize").width,t=this.scene.registry.get("mapSize").height;let s,i=[0,e],a=[0,t],h=Phaser.Math.Between(0,e);return s=h in i?Phaser.Math.Between(0,t):a[Phaser.Math.Between(0,1)],{x:h,y:s}}};class T extends Phaser.Scene{constructor(){super({key:"GameScene"}),this.generateRedPlane=()=>{for(let e of this.redPlanes.getChildren()){if(!(e instanceof k))return;if("idle"===e.state)return void e.startFlying()}},this.bulletHitLayer=e=>{e instanceof p&&(this.sound.mute||this.hitSound.play(),e.stop())},this.bulletHitObstacles=(e,t)=>{e instanceof p&&t instanceof S&&(this.sound.mute||this.hitSound.play(),e.stop())},this.enemyBulletHitPlayer=(e,t)=>{e instanceof p&&t instanceof b&&(this.sound.mute||this.hitSound.play(),e.stop(),t.gotHitByBullet(e.getDamage()))},this.planeMissileHitPlayer=(e,t)=>{e instanceof P&&t instanceof b&&(this.sound.mute||this.hitSound.play(),e.stop(),t.gotHitByBullet(e.getDamage()))},this.playerBulletHitEnemy=(e,t)=>{e instanceof p&&t instanceof n&&(this.sound.mute||this.hitSound.play(),e.stop(),t.gotHitByBullet(e.getDamage()))},this.handleEnemyKilled=()=>{this.numOfEnemyKilled+=1}}init(){this.numOfEnemyKilled=0}create(){this.winGame=!1,this.map=this.make.tilemap({key:"levelMap"}),this.tileset=this.map.addTilesetImage("tiles"),this.createLayer(),this.initObjectsGroup(),this.loadObjectsFromTilemap(),this.createPlanes(),this.createCollide(),this.createPlayerController(),this.addEventListener(),this.addTimeEvent(),this.addCustomCursor(),this.hitSound=this.sound.add("explosion"),this.cameras.main.startFollow(this.player),this.cameras.main.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels),this.registry.set("mapSize",{width:this.map.widthInPixels,height:this.map.heightInPixels})}update(){this.player.update(),this.playerController.handleInput(),this.checkGameOver()&&!this.winGame&&(this.events.emit("gameOver"),this.winGame=!0),this.redTanks.children.each((e=>{e instanceof f&&(e.update(),this.player.active&&e.active&&"pause"!==this.player.state&&e.getBarrel().rotateToTarget(this.player))}),this)}initObjectsGroup(){this.redTanks=this.add.group({runChildUpdate:!0}),this.redPlanes=this.add.group({runChildUpdate:!0}),this.obstacles=this.add.group({runChildUpdate:!0})}createLayer(){this.layer=this.map.createLayer("tileLayer",this.tileset,0,0),this.layer.setCollisionByProperty({collide:!0})}createPlayer(e,t){this.player=new b({scene:this,x:e,y:t,texture:"tankBlue"})}createRedTank(e,t){let s=new f({scene:this,x:e,y:t,texture:"tankRed"});this.redTanks.add(s)}createObstacles(e,t,s){let i=new S({scene:this,x:e,y:t-40,texture:s});this.obstacles.add(i)}loadObjectsFromTilemap(){this.map.getObjectLayer("objects").objects.forEach((e=>{"player"===e.type?this.createPlayer(e.x,e.y):"enemy"===e.type?this.createRedTank(e.x,e.y):this.createObstacles(e.x,e.y,e.type)}))}createPlanes(){for(let e=0;e<5;e++)this.createPlane()}createPlane(){let e=new k({scene:this,x:-50,y:-50,texture:"plane-red"});this.redPlanes.add(e),e.setTarget(this.player),e.setIdle()}createCollide(){this.physics.add.collider(this.player,this.layer),this.physics.add.collider(this.player,this.obstacles),this.physics.add.collider(this.player.getBullets(),this.layer,this.bulletHitLayer),this.physics.add.collider(this.player.getBullets(),this.obstacles,this.bulletHitObstacles),this.redTanks.children.each((e=>{e instanceof f&&(this.physics.add.overlap(this.player.getBullets(),e,this.playerBulletHitEnemy),this.physics.add.overlap(e.getBullets(),this.player,this.enemyBulletHitPlayer),this.physics.add.collider(e.getBullets(),this.obstacles,this.bulletHitObstacles),this.physics.add.collider(e.getBullets(),this.layer,this.bulletHitLayer))}),this),this.redPlanes.children.each((e=>{e instanceof k&&(this.physics.add.overlap(this.player.getBullets(),e,this.playerBulletHitEnemy),this.physics.add.overlap(e.getBullets(),this.player,this.planeMissileHitPlayer))}))}createPlayerController(){this.playerController=new class{constructor(e){this.player=e,this.scene=e.scene,this.checkDevice(),this.init()}isUsingPC(){return this.isPC}getPointer(){return this.pointer}getCursors(){return this.cursors}getJoyStickLeft(){return this.joyStickLeft}getJoyStickRight(){return this.joyStickRight}handleInput(){this.handleMove(),this.hanldeShoot()}handleMove(){this.isUsingPC()?this.handleMoveOnPC():this.handleMoveOnJoyStick()}hanldeShoot(){this.isUsingPC()?this.handleShootOnPC():this.handleShootOnJoyStick()}handleMoveOnPC(){this.cursors.up.isDown?this.player.move(this.player.rotation-.5*Math.PI,this.player.speed):this.cursors.down.isDown?this.player.move(this.player.rotation-.5*Math.PI,-this.player.speed):this.player.stop(),this.cursors.left.isDown?this.player.rotate(this.player.rotation-this.player.rotateSpeed):this.cursors.right.isDown&&this.player.rotate(this.player.rotation+this.player.rotateSpeed)}handleMoveOnJoyStick(){0!=this.joyStickLeft.force?(this.player.move(this.joyStickLeft.rotation,this.player.speed),this.player.rotate(this.joyStickLeft.rotation+.5*Math.PI)):this.player.stop()}handleShootOnPC(){let e=this.angleOfPointerAndPlayer()+.5*Math.PI;this.player.rotateBarrel(e),this.player.isAllowShoot()&&this.pointer.leftButtonDown()&&this.player.shoot()}handleShootOnJoyStick(){0!=this.joyStickRight.force&&this.player.isAllowShoot()&&(this.player.rotateBarrel(this.joyStickRight.rotation+.5*Math.PI),this.player.shoot())}angleOfPointerAndPlayer(){return Phaser.Math.Angle.Between(this.player.getBarrel().x,this.player.getBarrel().y,this.pointer.x+this.scene.cameras.main.scrollX,this.pointer.y+this.scene.cameras.main.scrollY)}checkDevice(){this.scene.game.device.os.desktop?this.isPC=!0:(this.scene.game.device.os.android||this.scene.game.device.os.iOS)&&(this.isPC=!1)}init(){this.isPC?this.initPC():this.initMobile()}initPC(){this.cursors=this.scene.input.keyboard.createCursorKeys(),this.pointer=this.scene.input.activePointer}initMobile(){this.joyStickLeft=this.scene.plugins.get("virtualJoystick").add(this.scene,{x:300,y:.5*this.scene.cameras.main.height+300,radius:200}),this.joyStickRight=this.scene.plugins.get("virtualJoystick").add(this.scene,{x:this.scene.cameras.main.width-300,y:.5*this.scene.cameras.main.height+300,radius:200}),this.scene.input.addPointer(2)}}(this.player)}addEventListener(){this.events.on("enemyDie",this.handleEnemyKilled)}addTimeEvent(){this.time.addEvent({delay:3e3,callback:this.generateRedPlane,repeat:-1})}addCustomCursor(){this.input.setDefaultCursor("url(assets/cursors/Aim.cur), pointer")}checkGameOver(){return 15==this.numOfEnemyKilled}}class D extends Phaser.GameObjects.Image{constructor(e,t,s,i){super(e,t,s,i),this.scene.add.existing(this),this.scaleRatio=1.5}init(e){return this.upTween=this.scene.add.tween({targets:this,y:{from:this.y,to:this.y+7},duration:100,paused:!0,yoyo:!0,repeat:0,onComplete:e}),this.moveTween=this.scene.add.tween({targets:this,y:{from:this.y,to:this.y+5},duration:100,paused:!0,yoyo:!0,repeat:0}),this.scaleUp=this.scene.add.tween({targets:this,scale:this.scaleRatio,duration:500,repeat:-1,yoyo:!0,ease:"Sine.easeInOut",paused:!0}),this}playPointerUp(){return this.moveTween.stop(),this.upTween.play(),this}playPointerMove(){return this.upTween.isPlaying()||this.moveTween.play(),this}playScale(){return this.scaleUp.play(),this}stopScale(){return this.scaleUp.stop(),this}setScaleAnimationRatio(e){return this.scaleRatio=e,this}}const C=D;class O extends Phaser.GameObjects.Container{constructor(e){super(e),this.bitmapTexts=[],this.highScore=0,this.handleNewGame=()=>{this.scene.time.delayedCall(1200,(()=>{let e=this.scene.scene.manager.getScene("GameScene");this.removeEventsListener(),e.scene.restart(),this.scene.registry.values.score=0,this.scene.scene.restart()})),this.disappear()},this.scene.add.existing(this),this.setPosition(.5*this.scene.cameras.main.width,0).setAlpha(.1),this.createBackground(),this.createTitle(),this.createScore(),this.createNewGameButton()}update(){this.visible&&this.scoreText.setText(`${Math.floor(this.counterTween.getValue())}`)}handleScoreAndHighScore(){this.handleHighScore(),this.displayScoreText(),this.displayHighScore()}setCounterTween(e){this.counterTween=this.scene.tweens.addCounter({from:0,to:e,duration:1500,paused:!0})}handleHighScore(){this.isHighScoreExist()||this.initHighScore(),this.setHighScore()}isHighScoreExist(){return null!==localStorage.getItem("highScore")}initHighScore(){localStorage.setItem("highScore","0")}displayScoreText(){this.setCounterTween(this.scene.registry.get("score")),this.counterTween.resume()}setHighScore(){let e=Number(localStorage.getItem("highScore")),t=this.scene.registry.get("score");e<t?(this.highScore=t,localStorage.setItem("highScore",t.toString())):this.highScore=e}createBackground(){this.background=this.scene.add.image(0,0,"popup_pause"),this.add(this.background)}createTitle(){let e=this.scene.add.bitmapText(0,0,"font","Game Over",35);this.bitmapTexts.push(e),Phaser.Display.Align.In.TopCenter(e,this.background,0,-20),e.setDepth(5),this.add(e)}createScore(){let e=this.scene.add.text(0,0,"Score ");this.scoreText=this.scene.add.text(0,0,"0"),e.setOrigin(0,0).setFontSize(30),this.scoreText.setOrigin(0,0).setFontSize(30),Phaser.Display.Align.In.Center(e,this.background,-30,-60),Phaser.Display.Align.In.Center(this.scoreText,this.background,30,-60),e.setDepth(5),this.scoreText.setDepth(5),this.add(e),this.add(this.scoreText)}displayHighScore(){let e=this.scene.add.text(0,0,`High score ${this.highScore}`);e.setOrigin(0,0).setFontSize(30),Phaser.Display.Align.In.Center(e,this.background,0,-10),e.setDepth(5),this.add(e)}createNewGameButton(){this.newGameButton=new C(this.scene,0,0,"restart_button"),Phaser.Display.Align.In.Center(this.newGameButton,this.background,90,80),this.newGameButton.setScale(3).init(this.handleNewGame).setInteractive().on("pointerup",(e=>{this.newGameButton.playPointerUp()})).on("pointermove",(e=>{this.newGameButton.playPointerMove()}));let e=this.scene.add.bitmapText(0,0,"font","New game",30);this.bitmapTexts.push(e),Phaser.Display.Align.In.Center(e,this.background,-40,80),this.add(e),this.add(this.newGameButton)}removeEventsListener(){let e=this.scene.scene.manager.getScene("GameScene");e.events.removeListener("enemyDie"),e.events.removeListener("gameOver"),e.events.removeListener("playerDie"),this.scene.events.removeListener("resumeGame"),this.scene.events.removeListener("pauseGame")}disappear(){this.scene.tweens.add({targets:this,props:{y:0,alpha:.1},duration:1e3,ease:"Expo.easeIn",onComplete:()=>{this.setVisible(!1)}})}appear(){this.setVisible(!0),this.scene.tweens.add({targets:this,props:{y:.5*this.scene.cameras.main.height,alpha:1},duration:1e3,ease:"Bounce.easeOut"})}}const M=O;class V extends Phaser.GameObjects.Container{constructor(e){super(e),this.bitmapTexts=[],this.handleClose=()=>{this.disappear(),this.scene.events.emit("resumeGame")},this.handleRestart=()=>{this.disappear(),this.scene.time.delayedCall(400,(()=>{let e=this.scene.scene.manager.getScene("GameScene");this.removeEventsListener(),e.scene.restart(),this.scene.registry.values.score=0,this.scene.scene.restart()}))},this.handleVolume=()=>{this.scene.sound.mute?(this.scene.sound.mute=!1,this.volumeButton.clearTint()):(this.scene.sound.mute=!0,this.volumeButton.setTint(14474460))},this.scene.add.existing(this),this.setPosition(.5*this.scene.cameras.main.width,this.scene.cameras.main.height).setScale(.1),this.createBackground(),this.createTitle(),this.createCloseButton(),this.createVolumeButton(),this.createRestartButton()}createBackground(){this.background=this.scene.add.image(0,0,"popup_pause"),this.add(this.background)}createTitle(){let e=this.scene.add.bitmapText(0,0,"font","Pause",35);this.bitmapTexts.push(e),Phaser.Display.Align.In.TopCenter(e,this.background,0,-20),e.setDepth(5),this.add(e)}createCloseButton(){this.closeButton=new C(this.scene,0,0,"close_button"),Phaser.Display.Align.In.TopRight(this.closeButton,this.background),this.closeButton.setScale(3).init(this.handleClose).setInteractive().on("pointerup",(e=>{this.closeButton.playPointerUp()})).on("pointermove",(e=>{this.closeButton.playPointerMove()})),this.add(this.closeButton)}createVolumeButton(){this.volumeButton=new C(this.scene,0,0,"volume_button"),Phaser.Display.Align.In.Center(this.volumeButton,this.background,50,50),this.volumeButton.setScale(3).init(this.handleVolume).setInteractive().on("pointerup",(e=>{this.volumeButton.playPointerUp()})).on("pointermove",(e=>{this.volumeButton.playPointerMove()}));let e=this.scene.add.bitmapText(0,0,"font","Volume",30);this.bitmapTexts.push(e),Phaser.Display.Align.In.Center(e,this.background,-50,50),this.add(e),this.add(this.volumeButton)}createRestartButton(){this.restartButton=new C(this.scene,0,0,"restart_button"),Phaser.Display.Align.In.Center(this.restartButton,this.background,50,-50),this.restartButton.setScale(3).init(this.handleRestart).setInteractive().on("pointerup",(e=>{this.restartButton.playPointerUp()})).on("pointermove",(e=>{this.restartButton.playPointerMove()}));let e=this.scene.add.bitmapText(0,0,"font","Restart",30);this.bitmapTexts.push(e),Phaser.Display.Align.In.Center(e,this.background,-50,-50),this.add(e),this.add(this.restartButton)}removeEventsListener(){let e=this.scene.scene.manager.getScene("GameScene");e.events.removeListener("enemyDie"),e.events.removeListener("gameOver"),this.scene.events.removeListener("resumeGame"),this.scene.events.removeListener("pauseGame")}disappear(){this.scene.tweens.add({targets:this,props:{y:this.scene.cameras.main.height,scale:.1},duration:300,ease:"Expo.easeIn",onComplete:()=>{this.setVisible(!1)}})}appear(){this.setVisible(!0),this.scene.tweens.add({targets:this,props:{y:.5*this.scene.cameras.main.height,scale:1},duration:300,ease:"Expo.easeOut"})}}const H=V;class G extends Phaser.Scene{constructor(){super({key:"HUDScene"}),this.handleSettings=()=>{this.settingButton.setVisible(!1),this.events.emit("pauseGame"),this.popupPause.appear()},this.handleResumeGame=()=>{this.settingButton.setVisible(!0)}}init(){this.isPointerOutButton=!0}create(){this.createButton(),this.createText(),this.createEvents(),this.createPopupPause(),this.createPopupGameOver()}update(){this.popupGameOver.update()}createButton(){this.settingButton=new C(this,this.sys.canvas.width-200,20,"settings_button"),this.settingButton.setOrigin(0).setScale(7).init(this.handleSettings).setInteractive().on("pointerup",(e=>{this.settingButton.playPointerUp()})).on("pointermove",(e=>{this.settingButton.playPointerMove(),this.isPointerOutButton&&(this.events.emit("pointerInButton"),this.isPointerOutButton=!1)})).on("pointerout",(e=>{this.events.emit("pointerOutButton"),this.isPointerOutButton=!0}))}createText(){this.textElements=new Map([["SCORE",this.addText(this.sys.canvas.width/2-200,50,`Score ${this.registry.get("score")}`)]])}createEvents(){const e=this.scene.get("GameScene");e.events.on("enemyDie",this.updateScore,this),e.events.on("gameOver",this.handleGameOver,this),e.events.on("playerDie",this.handleGameOver,this),this.events.on("resumeGame",this.handleResumeGame)}createPopupPause(){this.popupPause=new H(this),this.popupPause.setVisible(!1)}createPopupGameOver(){this.popupGameOver=new M(this),this.popupGameOver.setVisible(!1)}updateScore(e){var t;this.registry.set("score",this.registry.get("score")+e),null===(t=this.textElements.get("SCORE"))||void 0===t||t.setText(`Score ${this.registry.get("score")}`).setX(this.sys.canvas.width/2-200)}addText(e,t,s){return this.add.text(e,t,s).setOrigin(0,0).setFontSize(80)}handleGameOver(){this.popupGameOver.handleScoreAndHighScore(),this.popupGameOver.appear(),this.settingButton.setVisible(!1)}}const I=G;class R extends Phaser.Scene{constructor(){super({key:"MenuScene"}),this.bitmapTexts=[],this.handleClickPlayButton=()=>{this.scene.start("GameScene"),this.scene.start("HUDScene"),this.scene.bringToTop("HUDScene")}}init(){this.startKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),this.startKey.isDown=!1,this.initGlobalData()}create(){this.displayText(),this.createPlayButton()}displayText(){this.bitmapTexts.push(this.add.bitmapText(this.sys.canvas.width/2-140,this.sys.canvas.height/2-100,"font","TANK",100))}createPlayButton(){this.playButton=new C(this,this.sys.canvas.width/2,this.sys.canvas.height/2+100,"play_button"),this.playButton.setScale(7).setScaleAnimationRatio(7.2).init(this.handleClickPlayButton).setInteractive().playScale().on("pointerup",(e=>{this.playButton.playPointerUp().stopScale()})).on("pointermove",(e=>{this.playButton.playPointerMove()}))}initGlobalData(){this.registry.set("score",0)}update(){this.startKey.isDown&&(this.scene.start("GameScene"),this.scene.start("HUDScene"),this.scene.bringToTop("HUDScene"))}}var A=s(122);const F={title:"Tank",url:"https://github.com/digitsensitive/phaser3-typescript",version:"2.0",scale:{autoCenter:Phaser.Scale.CENTER_BOTH,mode:Phaser.Scale.FIT,width:2200,height:1200},type:Phaser.AUTO,parent:"game",scene:[i,R,I,T],input:{gamepad:!0,keyboard:!0},physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},plugins:{global:[{key:"virtualJoystick",plugin:A.Z,start:!0}]},backgroundColor:"#000000",render:{pixelArt:!1,antialias:!0}};class j extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new j(F)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(e){var a=s[e];if(void 0!==a)return a.exports;var h=s[e]={exports:{}};return t[e].call(h.exports,h,h.exports,i),h.exports}i.m=t,e=[],i.O=(t,s,a,h)=>{if(!s){var n=1/0;for(c=0;c<e.length;c++){for(var[s,a,h]=e[c],o=!0,r=0;r<s.length;r++)(!1&h||n>=h)&&Object.keys(i.O).every((e=>i.O[e](s[r])))?s.splice(r--,1):(o=!1,h<n&&(n=h));if(o){e.splice(c--,1);var l=a();void 0!==l&&(t=l)}}return t}h=h||0;for(var c=e.length;c>0&&e[c-1][2]>h;c--)e[c]=e[c-1];e[c]=[s,a,h]},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,h,[n,o,r]=s,l=0;if(n.some((t=>0!==e[t]))){for(a in o)i.o(o,a)&&(i.m[a]=o[a]);if(r)var c=r(i)}for(t&&t(s);l<n.length;l++)h=n[l],i.o(e,h)&&e[h]&&e[h][0](),e[h]=0;return i.O(c)},s=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(751)));var a=i.O(void 0,[216],(()=>i(204)));a=i.O(a)})();